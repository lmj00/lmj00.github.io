---
title: "SSL/TLS"
layout: post
categories: cs
modified_date: 2025-10-13
--- 

기존의 C#으로 구성된 OMS 테스트 프로그램을 파이썬으로 마이그레이션 하는 중에
`SSL/TLS 암호화 규약 불일치 (ConnectionResetError)` 문제를 알게되어 기록한다.

### [SSL(Secure Sockets Layer)](https://www.cloudflare.com/ko-kr/learning/ssl/what-is-ssl/)

> 암호화 기반 인터넷 보안 프로토콜입니다. 인터넷 통신의 개인정보 보호, 인증, 데이터 무결성을 보장하기 위해 `Netscape`가 1995년 처음으로 개발했습니다. SSL은 현재 사용 중인 TLS 암호화의 전신입니다.


### [SSL 작동 방식](https://docs.python.org/3/library/ssl.html#module-ssl)

#### 소켓 생성
```python
import socket
import ssl
import certifi

hostname = 'www.python.org'

with socket.create_connection((hostname, 443)) as sock: # TCP 연결
    context = ssl.create_default_context(cafile=certifi.where()) # SSL 컨텍스트 생성

    with context.wrap_socket(sock, server_hostname=hostname) as ssock: # SSL 핸드셰이크
        print(f'TLS 버전: {ssock.version()}') # TLSv1.3
        print(f'암호화 방식: {ssock.cipher()}') # ('TLS_AES_128_GCM_SHA256', 'TLSv1.3', 128)
```

<br>

SSL 컨텍스트의 기능
- 인증서 검증 설정
- 신뢰할 수 있는 CA 선택
- TLS 사용, SSL 2.0/3.0 차단
- 암호화 정책

### SSL과 TLS(Transport Layer Security)()
> SSL은 TLS의 직접적인 전신입니다. 1999년, 인터넷 엔지니어링 태스크 포스(IETF)는 SSL에 대한 업데이트를 제안했다. 이 업데이트는 넷스케이프의 개입 없이 IETF에 의해 개발되었기 때문에, 이름은 TLS로 변경되었다. SSL(3.0)의 마지막 버전과 TLS의 첫 번째 버전 사이의 변화는 중요하지 않았다. 이름 변경은 주로 새로운 소유권을 의미했습니다.

<br>

> SSL과 TLS는 매우 유사하기 때문에 사람들은 종종 용어를 같은 의미로 사용합니다. 일부는 여전히 SSL이라고 부르는 반면, SSL은 여전히 널리 인식되기 때문에 "SSL/TLS 암호화"를 사용합니다.


### ConnectionResetError 원인
API 서버는 오래된 SSL/TLS 버전(TLS 1.0/1.1)만 지원했었는데,
Python의 기본 프로토콜은 보안 강화를 위해 최신 버전(TLS 1.2/1.3)만 허용해서
프로토콜 협상 실패로 ConnectionResetError가 발생했다.

해결방법
```python
# Python에서 구형 서버와 호환되는 SSL 컨텍스트 생성
context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)

# 인증서 검증 비활성화
context.check_hostname = False
context.verify_mode = ssl.CERT_NONE

# 구형 서버와 호환성을 위해 보안 수준 낮춤
context.set_ciphers('DEFAULT@SECLEVEL=1') # SECLEVEL=1: 낮은 보안 수준

# SSL 컨텍스트 적용
http = urllib3.PoolManager(ssl_context=context)
response = http.request('GET', full_url, ...)
```

### cryptography
파이썬 코드로 SSL/TLS를 구현하기 위해 필요한 파이썬 라이브러리다.